# 品質チェック基準

このスキルで使用する品質チェックのしきい値と設定。

## Lintチェック基準

### JavaScript/TypeScript プロジェクト

#### ESLint
- **エラー数**: 0件（警告は許容）
- **重要度**: Errorレベルは0件必須
- **対象ファイル**: ステージングされたファイルのみ

#### Prettier
- **フォーマットエラー**: 0件
- **対象**: 全ファイル
- **チェック項目**:
  - インデント
  - 引用符の一貫性
  - セミコロンの有無
  - 改行コード

### Python プロジェクト

#### Black
- **フォーマットエラー**: 0件
- **ライン長**: 88文字以内
- **対象**: ステージングされたファイルのみ

#### Flake8 (オプション)
- **エラー数**: 0件
- **警告数**: 5件以内
- **複雑度**: 循環的複雑度10以下

## テスト品質基準

### Jest/Vitest
- **テスト成功率**: 100%（失敗0件）
- **最低カバレッジ**: 70%
- **推奨カバレッジ**: 80%以上
- **対象**: プロジェクト全体
- **タイムアウト**: 5分

### pytest
- **テスト成功率**: 100%（失敗0件）
- **最低カバレッジ**: 70%
- **推奨カバレッジ**: 80%以上
- **カバレッジ測定**: `--cov` オプション使用
- **タイムアウト**: 5分

### カバレッジ測定対象
- ステートメントカバレッジ
- ブランチカバレッジ
- ファンクションカバレッジ
- ラインカバレッジ

## コードレビュー基準

### セキュリティチェック

#### 高危険度 (ブロック)
- ハードコードされたパスワード/APIキー
- eval() や exec() の使用
- SQLインジェクション脆弱性
- XSS脆弱性
- シェルインジェクションリスク

#### 中危険度 (警告)
- デバッグコードの残存 (console.log, print)
- TODO/FIXMEコメント
- あまりに長い関数

### コード品質チェック

#### 複雑度
- **関数長**: 50行以内
- **循環的複雑度**: 10以下
- **ネスト深度**: 4階層以内

#### 命名規則
- 関数名: camelCase または snake_case
- 変数名: camelCase または snake_case
- 定数: UPPER_CASE
- クラス名: PascalCase または CamelCase

#### コードスタイル
- **行長**: 120文字以内
- **1関数1責任**: 遵守
- **重複コード**: 最小化

## コミット品質基準

### コミットメッセージ
- **形式**: Conventional Commits準拠
- **Type**: feat, fix, docs, test, chore など
- **Scope**: 可能な限り指定
- **Description**: 50文字以内
- **Body**: 必要に応じて詳細を記載

### 変更の粒度
- **コミット単位**: 機能的に関連する変更
- **ファイル数**: 理想的には5ファイル以内
- **変更規模**: 1コミットで1機能完結が理想

## 設定ファイル

### review_config.json
```json
{
  "security": {
    "blocked_patterns": [
      "password\\s*=",
      "api_key\\s*=",
      "secret\\s*=",
      "token\\s*=",
      "eval\\s*\\(",
      "exec\\s*\\(",
      "shell=True"
    ]
  },
  "quality": {
    "max_function_lines": 50,
    "max_line_length": 120,
    "warn_patterns": [
      "console\\.log",
      "print\\s*\\(",
      "TODO:",
      "FIXME:",
      "HACK:"
    ]
  },
  "complexity": {
    "max_cyclomatic_complexity": 10,
    "max_nesting_depth": 4
  },
  "thresholds": {
    "test_coverage_min": 70,
    "test_coverage_recommended": 80,
    "max_lint_warnings": 5
  }
}
```

## エラーハンドリング

### Lintエラー
- **Errorレベル**: コミットブロック
- **Warningレベル**: 警告表示のみ
- **修正提案**: 自動修正可能な場合提示

### テストエラー
- **失敗テスト**: コミットブロック
- **カバレッジ不足**: 警告表示
- **タイムアウト**: エラーとして処理

### セキュリティ問題
- **高危険度**: コミットブロック
- **中危険度**: 警告表示
- **低危険度**: 情報提供のみ

## 品質スコア計算

各チェック項目から品質スコアを算出:

- **Lintチェック**: 30点
  - エラー0件: 30点
  - 警告1件: 25点
  - 警告2-3件: 20点
  - 警告4件以上: 10点

- **テストチェック**: 40点
  - 全テスト成功 + カバレッジ80%+: 40点
  - 全テスト成功 + カバレッジ70-80%: 35点
  - 全テスト成功 + カバレッジ70%未満: 25点
  - テスト失敗: 0点

- **コードレビュー**: 30点
  - セキュリティ問題なし + 品質問題最小: 30点
  - 軽微な品質問題: 25点
  - 中程度の品質問題: 15点
  - 重大な問題: 0点

**合格基準**: 80点以上